<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Quetzal-CoaTL: Reading spatial variables from rasters</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-darkmode-toggle.js" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-fragment-copy-button.js" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
</script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
</script>
<a href="https://github.com/Quetzal-framework/quetzal-CoaTL" class="github-corner" aria-label="View source on GitHub">
  <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#70B7FD; color:#151513; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
    <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
    <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body">
    </path>
  </svg>
</a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="quetzal-coaltl-fa.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Quetzal-CoaTL
   </div>
   <div id="projectbrief">The Coalescence Template Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('geotiff_parser.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Reading spatial variables from rasters </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><ul><li class="level2"><a href="#autotoc_md81">Reading a single variable</a></li>
<li class="level2"><a href="#autotoc_md83">Reading multiple variables</a></li>
<li class="level2"><a href="#autotoc_md85">Next steps</a><ul><li class="level3"><a href="#autotoc_md87">Demes on a regular spatial grid</a></li>
<li class="level3"><a href="#autotoc_md89">Demes on a variable spatial graph</a></li>
<li class="level3"><a href="#autotoc_md91">Inform local processes</a></li>
</ul>
</li>
</ul>
</ul>
</div>
<div class="textblock"><h2><a class="anchor" id="autotoc_md81"></a>
Reading a single variable</h2>
<p>Landscapes, along with their spatial and temporal heterogeneity, play a significant role in shaping the dynamics of populations and lineages. In computational models, these landscapes are often represented as geospatial grids or rasters.</p>
<p>In most analyses, it is common for users to establish connections between local growth processes and a habitability raster obtained from Ecological Niche Models. Additionally, they may associate dispersal or connectivity with a Digital Elevation Model.</p>
<p>The Quetzal library offers a <a class="el" href="classquetzal_1_1geography_1_1raster.html" title="Discrete spatio-temporal variations of an environmental variable.">quetzal::geography::raster</a> class with a streamlined interface to incorporate these spatial grids into georeferenced coalescence simulations.</p>
<p>By utilizing <a class="el" href="classquetzal_1_1geography_1_1raster.html" title="Discrete spatio-temporal variations of an environmental variable.">quetzal::geography::raster</a>, you can define a single variable that encompasses:</p>
<ul>
<li>Spatial heterogeneity: Rasters divide a geographical space into cells identified by their row and column coordinates.</li>
<li>Temporal heterogeneity: Rasters have a depth, meaning multiple bands (layers) that are utilized to model the temporal dimension.</li>
</ul>
<p>When reading a variable using the <code>from_file</code>() function, there are a few considerations to keep in mind:</p>
<ol type="1">
<li>You need to decide on the raster template argument <code>time_type</code>. In most cases, it would be an integer representing a band mapped to a year (e.g., 2023 for the latest band). However, you can opt for a more complex type such as a time period (e.g., 7000–3000 BCE).</li>
<li>Keep in mind that duplicating identical bands is unnecessary and can make the raster bulky. Instead, you can virtualize repeated bands using the VRT (Virtual Dataset) format. See the Python <b>Quetzal-CRUMBS</b> helper library to do so.</li>
<li>There are multiple ways to identify locations within a spatial grid, and the choice depends on the specific usage context. The <code><a class="el" href="classquetzal_1_1geography_1_1raster.html" title="Discrete spatio-temporal variations of an environmental variable.">quetzal::geography::raster</a></code> interface allows for switching between them:<ul>
<li><code>lonlat</code> or <code>latlon</code>: Decimal longitude and latitude values, which may or may not fall within the spatial extent of the grid. Genetic samples and other user inputs will generally use these real-world coordinate formats and may require projection into a <code>location_descriptor</code>.</li>
<li><code>colrow</code> or <code>rowcol:</code> The most intuitive way to index the cells of a grid.</li>
<li><code>location_descriptor</code>: A one-dimensional index representing the grid cells. It can be thought of as mapping 0 to the top-left cell (grid origin) and width × height - 1 to the bottom-right cell. Since it's a simple integer, this 1D system is computationally efficient and designed for intensive simulations. Converting a <code>location_descriptor</code> to <code>latlon</code> or <code>lonlat</code> will provide the coordinates of the cell centroid. The <code>to_centroid</code> function is also available for this purpose.</li>
</ul>
</li>
<li>When reading the value of a variable at a specific location, it may or may not exist. In the latter case, it is considered a NA (Not Available) value, and an empty optional is returned. The actual representation of NA in the dataset can be obtained using the <code>NA()</code> function.</li>
</ol>
<p><b>Input</b></p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;quetzal/quetzal.hpp&quot;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &lt;filesystem&gt;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160; </div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacequetzal.html">quetzal</a>;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160; </div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    <span class="comment">//  Expected dataSet structure</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    <span class="comment">//  * origin at Lon -5, Lat 52.</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    <span class="comment">//  * 9 cells</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    <span class="comment">//  * 10 layers</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    <span class="comment">//  * pixel size (-5, 5)</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    <span class="comment">//  * East and South limits ARE NOT in spatial extent</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    <span class="comment">// (origin)     -5        0       5      10</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    <span class="comment">//         \   /         /       /      /</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    <span class="comment">//          \ /         /       /      /</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    <span class="comment">//      52   * ------ * ----- * ---- *</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="comment">//           |    .   |   .   |   .</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <span class="comment">//           |   c0   |  c1   |  c2</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <span class="comment">//      47   * ------ * ----- * ---- *</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <span class="comment">//           |    .   |   .   |   .</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <span class="comment">//           |   c3   |  c4   |  c5</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="comment">//      42   * ------ * ----- * ---- *</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="comment">//           |   .    |   .   |   .</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="comment">//           |   c6   |  c7   |  c8</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="comment">//      37   *        *       *      *</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="comment">// </span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="comment">//          90</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="comment">//          |         (+)</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="comment">//      0 --------------&gt; 180    X size positive in decimal degre (east direction positive)</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="comment">//          |                    Y size negative in decimal degree (south direction negative)</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="comment">//          |</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="comment">//          |</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="comment">//          |</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="comment">//     (-)  v        </span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="comment">//          0                     </span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="keywordtype">int</span> main()</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;{</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keyword">using</span> time_type = int;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keyword">using</span> <a class="code" href="classquetzal_1_1geography_1_1raster.html">raster_type</a> = <a class="code" href="classquetzal_1_1geography_1_1raster.html">geography::raster&lt;time_type&gt;</a>;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="comment">// The raster has 10 bands that we will assign to 2001 ... 2011.</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    std::vector&lt;time_type&gt; times(10);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    std::iota(times.begin(), times.end(), 2001);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; </div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keyword">auto</span> file = std::filesystem::current_path() / <span class="stringliteral">&quot;data/bio1.tif&quot;</span>;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">// Read the raster</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keyword">auto</span> bio1 = <a class="code" href="classquetzal_1_1geography_1_1raster.html#a0ff840b704392f9ef3e63d4b74a83385">raster_type::from_file</a>(file, times);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    std::cout &lt;&lt; bio1 &lt;&lt; std::endl;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="comment">// Check there are 10 bands/layers/time periods</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    assert( std::ranges::distance(bio1.times()) == 10 );</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="comment">// There are 9 cells/spatial coordinates</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    assert( std::ranges::distance(bio1.locations()) == 9 );</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160; </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">// You will typically have georeferenced sampling points</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keyword">using</span> <a class="code" href="structquetzal_1_1geography_1_1latlon.html">latlon</a> =  <span class="keyword">typename</span> <a class="code" href="structquetzal_1_1geography_1_1latlon.html">raster_type::latlon</a>;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keyword">using</span> lonlat =  <span class="keyword">typename</span> <a class="code" href="structquetzal_1_1geography_1_1lonlat.html">raster_type::lonlat</a>;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keyword">auto</span> point_1 = <a class="code" href="structquetzal_1_1geography_1_1latlon.html">latlon</a>(52., -5.);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keyword">auto</span> point_2 = lonlat(-5., 52.);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160; </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    assert(point_1 == point_2);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment">// Defines a lambda expression for checking extent</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keyword">auto</span> check = [&amp;bio1](<span class="keyword">auto</span> x){</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;Point &quot;</span> &lt;&lt; x &lt;&lt; <span class="stringliteral">&quot; is &quot;</span> </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                &lt;&lt; ( bio1.contains(x) ? <span class="stringliteral">&quot; &quot;</span> : <span class="stringliteral">&quot;not &quot;</span>)</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;in bio1 extent&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    };</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    check(point_1);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keyword">auto</span> point_3 = lonlat(-99., 99);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    check(point_3);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">// Computing distance will come handy for spatial graphs</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    std::cout &lt;&lt; point_1 &lt;&lt; <span class="stringliteral">&quot; is &quot;</span> </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;              &lt;&lt; point_1.great_circle_distance_to(point_3)</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; km away from &quot;</span> &lt;&lt; point_3 &lt;&lt; std::endl;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160; </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="comment">// Coordinates</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keyword">auto</span> x = bio1.to_descriptor(bio1.origin());</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keyword">auto</span> t = bio1.times().front();</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="comment">// 1D location descriptors can be converted to 2D coordinate systems</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;All equivalent:\n\t&quot;</span> </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;              &lt;&lt; x &lt;&lt; <span class="stringliteral">&quot;\n\t&quot;</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;              &lt;&lt; bio1.to_rowcol(x) &lt;&lt; <span class="stringliteral">&quot;\n\t&quot;</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;              &lt;&lt; bio1.to_colrow(x) &lt;&lt; <span class="stringliteral">&quot;\n\t&quot;</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;              &lt;&lt; bio1.to_latlon(x) &lt;&lt; <span class="stringliteral">&quot;\n\t&quot;</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;              &lt;&lt; bio1.to_lonlat(x) &lt;&lt; std::endl;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">// Retrieve the raster value, that may be defined.</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    std::optional&lt;double&gt; maybe_bio1 = bio1.at(x,t);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160; </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">// It may be a NA, let&#39;s check for it:</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;bio1(&quot;</span> &lt;&lt; x &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; t &lt;&lt; <span class="stringliteral">&quot;) is &quot;</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;              &lt;&lt; ( maybe_bio1.has_value() ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;not&quot;</span>)</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;defined.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="comment">// If value is not defined (empty optional), let&#39;s use the raster NA value.</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    std::cout &lt;&lt; maybe_bio1.value_or(bio1.NA()) &lt;&lt;  std::endl;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;}</div>
<div class="ttc" id="aclassquetzal_1_1geography_1_1raster_html"><div class="ttname"><a href="classquetzal_1_1geography_1_1raster.html">quetzal::geography::raster</a></div><div class="ttdoc">Discrete spatio-temporal variations of an environmental variable.</div><div class="ttdef"><b>Definition:</b> raster.hpp:41</div></div>
<div class="ttc" id="aclassquetzal_1_1geography_1_1raster_html_a0ff840b704392f9ef3e63d4b74a83385"><div class="ttname"><a href="classquetzal_1_1geography_1_1raster.html#a0ff840b704392f9ef3e63d4b74a83385">quetzal::geography::raster::from_file</a></div><div class="ttdeci">static raster from_file(const std::filesystem::path &amp;file, const std::vector&lt; time_type &gt; &amp;times)</div><div class="ttdoc">Read the raster from an input file in the geotiff format.</div><div class="ttdef"><b>Definition:</b> raster.hpp:130</div></div>
<div class="ttc" id="anamespacequetzal_html"><div class="ttname"><a href="namespacequetzal.html">quetzal</a></div><div class="ttdoc">Simulation of coalescence-based models of molecular evolution.</div><div class="ttdef"><b>Definition:</b> merge.hpp:24</div></div>
<div class="ttc" id="astructquetzal_1_1geography_1_1latlon_html"><div class="ttname"><a href="structquetzal_1_1geography_1_1latlon.html">quetzal::geography::latlon</a></div><div class="ttdoc">Geographic coordinates.</div><div class="ttdef"><b>Definition:</b> coordinates.hpp:178</div></div>
<div class="ttc" id="astructquetzal_1_1geography_1_1lonlat_html"><div class="ttname"><a href="structquetzal_1_1geography_1_1lonlat.html">quetzal::geography::lonlat</a></div><div class="ttdoc">Geographic coordinates.</div><div class="ttdef"><b>Definition:</b> coordinates.hpp:216</div></div>
</div><!-- fragment --><p><b>Output</b></p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Origin: (Lat: 52 , Lon: -5)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;Width: 3</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Height: 3</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Depth: 10</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Resolution: </div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    Lat: -5</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    Lon: 5</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;Extent:</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    Lat min: 37</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    Lat max: 52</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    Lon min: -5</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    Lon max: 10</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;NA value: -1.7e+308</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;Point (Lat: 52 , Lon: -5) is  in bio1 extent</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;Point (Lat: 99 , Lon: -99) is not in bio1 extent</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;(Lat: 52 , Lon: -5) is 4256.19 km away from (Lat: 99 , Lon: -99)</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;All equivalent:</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    0</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    (Column: 0 , Row: 0)</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    (Column: 0 , Row: 0)</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    (Lat: 49.5 , Lon: -2.5)</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    (Lat: 49.5 , Lon: -2.5)</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;bio1(0,0) is defined.</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;104.602</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md83"></a>
Reading multiple variables</h2>
<p>Aligning rasters refers to a spatial data representation technique used in Geographic Information Systems (GIS). In this context, raster data layers are aligned and registered to a common coordinate system and grid structure. This ensures that the cells or pixels in the raster layers are spatially aligned and correspond to the same geographic locations.</p>
<p>Alignment is achieved in <code><a class="el" href="classquetzal_1_1geography_1_1raster.html" title="Discrete spatio-temporal variations of an environmental variable.">quetzal::geography::raster</a></code> objects by defining a consistent grid structure, such as a uniform cell size and orientation, for all raster layers.</p>
<p>In situations where multiple GIS variables that change over time are involved (such as a suitability and an elevation across geological times), an additional alignment mechanism is required. The <code><a class="el" href="classquetzal_1_1geography_1_1landscape.html" title="Discrete spatio-temporal variations of a set of environmental variables.">quetzal::geography::landscape</a></code> class addresses this need by combining multiple raster datasets, each potentially having multiple layers, into a single cohesive object. It ensures that all spatial grids are properly aligned and maintains the temporal dimension represented by multiple layers. This allows for accurate overlay, simulation, and composition of multiple datasets within the GIS environment.</p>
<p><b>Input</b></p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;quetzal/quetzal.hpp&quot;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &lt;filesystem&gt;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160; </div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacequetzal.html">quetzal</a>;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160; </div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keywordtype">int</span> main()</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;{</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    <span class="comment">// What type you want to use to identify the variable: could also be e.g. an integer</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    <span class="keyword">using</span> key_type = std::string;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160; </div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    <span class="comment">// What type you want to use to identify the variable: could also be e.g. a time period</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    <span class="keyword">using</span> time_type = int;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    <span class="comment">// Let&#39;s define a shorter alias</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    <span class="keyword">using</span> <a class="code" href="classquetzal_1_1geography_1_1landscape.html">landscape_type</a> = <a class="code" href="classquetzal_1_1geography_1_1landscape.html">quetzal::geography::landscape&lt;key_type, time_type&gt;</a>;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160; </div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    <span class="keyword">auto</span> file1 = std::filesystem::current_path() / <span class="stringliteral">&quot;data/bio1.tif&quot;</span>;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    <span class="keyword">auto</span> file2 = std::filesystem::current_path() / <span class="stringliteral">&quot;data/bio12.tif&quot;</span>;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; </div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <span class="comment">// The raster have 10 bands that we will assign to 2001 ... 2011.</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    std::vector&lt;time_type&gt; times(10);</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    std::iota(times.begin(), times.end(), 2001);</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="comment">// Initialize the landscape: for each var a key and a file, for all a time series.</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="keyword">auto</span> env = <a class="code" href="classquetzal_1_1geography_1_1landscape.html#a0fa9fa6c1e027352919bb35d2b40c61b">landscape_type::from_files</a>( { {<span class="stringliteral">&quot;bio1&quot;</span>, file1}, {<span class="stringliteral">&quot;bio12&quot;</span>, file2} }, times );</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    std::cout &lt;&lt; env &lt;&lt; std::endl;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160; </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="comment">// We indeed recorded 2 variables: bio1 and bio12</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    assert(env.size() == 2);</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="comment">// The semantic shares strong similarities with a raster</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    landscape_type::latlon Bordeaux(44.5, 0.34);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    assert(env.contains(Bordeaux));</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    assert(env.contains( env.to_centroid(Bordeaux) ) );</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="comment">// These little function-objects will soon be very handy to embed the GIS variables </span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="comment">// into the simulation with quetzal::expressive</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; f = env[<span class="stringliteral">&quot;bio1&quot;</span>].to_view();</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; g = env[<span class="stringliteral">&quot;bio12&quot;</span>].to_view();</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="comment">// But for now just print their raw data if defined or any other value if undefined</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> t : env.times())</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    {</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> x : env.locations())</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;            f(x,t).value_or(0.0);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;            g(x,t).value_or(env[<span class="stringliteral">&quot;bio12&quot;</span>].NA());</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        }</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    }</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;}</div>
<div class="ttc" id="aclassquetzal_1_1geography_1_1landscape_html"><div class="ttname"><a href="classquetzal_1_1geography_1_1landscape.html">quetzal::geography::landscape</a></div><div class="ttdoc">Discrete spatio-temporal variations of a set of environmental variables.</div><div class="ttdef"><b>Definition:</b> landscape.hpp:40</div></div>
<div class="ttc" id="aclassquetzal_1_1geography_1_1landscape_html_a0fa9fa6c1e027352919bb35d2b40c61b"><div class="ttname"><a href="classquetzal_1_1geography_1_1landscape.html#a0fa9fa6c1e027352919bb35d2b40c61b">quetzal::geography::landscape::from_files</a></div><div class="ttdeci">static landscape from_files(const std::map&lt; key_type, std::filesystem::path &gt; &amp;files, const std::vector&lt; time_type &gt; &amp;times)</div><div class="ttdoc">Read the rasters from a set of input geotiff files.</div><div class="ttdef"><b>Definition:</b> landscape.hpp:127</div></div>
</div><!-- fragment --><p><b>Output</b></p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Landscape of 2 aligned rasters:</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;bio1 bio12 </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Origin: (Lat: 52 , Lon: -5)</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Width: 3</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Height: 3</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;Depth: 10</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;Resolution: </div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    Lat: -5</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    Lon: 5</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;Extent:</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    Lat min: 37</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    Lat max: 52</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    Lon min: -5</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    Lon max: 10</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md85"></a>
Next steps</h2>
<p>Geospatial datasets play a crucial role in coalescence by providing valuable information about the demographic process. Once a raster is successfully parsed, users typically have three primary objectives they may want to pursue:</p>
<hr  />
<h3><a class="anchor" id="autotoc_md87"></a>
Demes on a regular spatial grid</h3>
<p>The rasters grid structure can be employed to construct a spatial graph of demes that is fully connected and utilized for simulating the demographic process. This is pertinent when looking at very larged continuous land masses. In this context:</p>
<ul>
<li>Vertices correspond to demes (populations) and are represented by the centroids of the raster cells.</li>
<li>Edges represent the distances between demes, and their connectivity can be modified using dispersal kernels.</li>
</ul>
<hr  />
<h3><a class="anchor" id="autotoc_md89"></a>
Demes on a variable spatial graph</h3>
<p>In archipelagos or clusters of loosely connected islands, the fluctuations in sea levels have a notable impact on the dynamics of species. These variations cause the intermittent connection and separation of land masses and their corresponding populations. Similarly, climatic shifts in sky-island complexes can have similar effects. As a result, the assumption of a completely interconnected graph representing population units (demes) is no longer applicable in these situations.</p>
<p>To address this, Digital Elevation Models (DEMs) can be utilized to establish a relationship between the dynamics of sea levels and species. In these cases, the connectivity of the graph at any given time is determined by the current elevation, and changes in elevation directly impact the level of connectivity between different areas.</p>
<hr  />
<h3><a class="anchor" id="autotoc_md91"></a>
Inform local processes</h3>
<p>Ecological Niche Models (ENMs) play a crucial role in predicting how populations might respond to changes in climate, both in the past and the future.</p>
<p>Typically, these models produce raster outputs that represent estimates of suitability. These suitability values are then utilized to determine growth rates and carrying capacity.</p>
<p>By utilizing the values within the raster, it becomes possible to derive demographic quantities through the construction of mathematical expressions that incorporate both time and space. This approach is exemplified in the <code><a class="el" href="namespacequetzal_1_1expressive.html" title="Mathematical expressions of spatio-temporal quantities.">quetzal::expressive</a></code> framework.</p>
<p>When encountering NA values, such as cells representing oceanic areas or those lying outside the spatial extent of the raster, the <code>std::optional</code> mechanism is employed. This means that these values may or may not have a defined value, leaving it to the user to decide how to handle such cases. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
